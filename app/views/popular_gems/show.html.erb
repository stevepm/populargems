<div class="container">
  <div class="row">
    <div class="col-md-offset-1 col-md-10 col-lg-offset-2 col-lg-8">
      <div class="well profile">
        <div class="col-sm-12">
          <div class="col-xs-12">
            <div class="col-xs-5">
              <%= render partial: 'shared/heart_button', locals: {gem: @gem} %>
              <%= render partial: 'shared/gem_likes_label', locals: {gem: @gem} %>
              <h2><%= @gem.name %></h2>
            </div>
            <div class="col-xs-7 text-center">
              <div class="col-xs-5 pull-right">
                <%= link_to 'Update Now', edit_popular_gem_path(@gem), class: "btn btn-warning btn-block pull-right active" %>
              </div>
              <small class="col-xs-5 pull-right">Last updated on <%= @gem.updated_at.to_date %></small>
            </div>
            <div class="col-xs-12">
              <p><strong>Version: </strong><%= @gem.version %></p>

              <p><strong>About: </strong><%= @gem.description %></p>
            </div>
          </div>
        </div>
        <div class="col-xs-12 divider text-center">
          <div class="col-xs-12 col-sm-6 emphasis">
            <h2><strong><%= number_with_delimiter(@gem.total_downloads, :delimiter => ',') %></strong></h2>

            <p>
              <small>Total Downloads</small>
            </p>
            <a href="<%= @gem.url %>" class="btn btn-success btn-block active">View on Rubygems</a>

          </div>
          <div class="col-xs-12 col-sm-6 emphasis">
            <h2><strong><%= number_with_delimiter(@gem.version_downloads, :delimiter => ',') %></strong></h2>

            <p>
              <small>Version Downloads</small>
            </p>
            <a href="<%= @gem.project_url %>" class="btn btn-info btn-block active">View Project</a>
          </div>
        </div>
      </div>
      <div>
        <h1>Comments:</h1>

        <div id="comments">
          <% @comments.each do |comment| %>
            <hr/>
            <div class="col-xs-1">
              <% if logged_in? && !current_user.comments.include?(comment) %>
                <% if current_user.liked? comment
                     liked = 'text-primary bg-warning'
                   elsif current_user.disliked? comment
                     unliked = 'text-primary bg-warning'
                   end %>

                <ul class="list-unstyled">
                  <li>
                    <small>
                      <%= link_to up_vote_comment_path(comment.id, current_user.id), method: :post, id: "vote-up" do %>
                        <span class='glyphicon glyphicon-chevron-up <%= liked %> h5'></span>
                      <% end %>
                    </small>
                  </li>
                  <li>
                    <small>
                      <%= link_to down_vote_comment_path(comment.id, current_user.id), method: :post, id: "vote-down" do %>
                        <span class='glyphicon glyphicon-chevron-down <%= unliked %> h5'></span>
                      <% end %>
                    </small>
                  </li>
                </ul>
              <% end %>
            </div>

            <div class="col-xs-11 comment">
              <div class="break-word">
                <%= comment.body.html_safe %>
              </div>
              <div class="row">
                <div class="col-xs-4 col-xs-offset-8">
                  <strong><%= link_to comment.user.name, comment.user %>:</strong>
                  <span class="badge alert-warning" id="points"><%= comment.user.points %></span>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-4 col-xs-offset-8">
                  <% if logged_in? && current_user.comments.include?(comment) %>
                    <small><%= link_to '[Delete comment]', comment, method: :delete %></small>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
        <% if logged_in? %>
          <%= form_for @comment, html: {class: "form-horizontal"} do |f| %>
            <div class="form-group">
              <%= f.text_area :body, class: "form-control", placeholder: 'Leave a comment' %>
            </div>
            <%= f.hidden_field :user, value: current_user.id %>
            <%= f.hidden_field :popular_gem, value: @gem.id %>
            <%= f.submit :Comment, class: "btn btn-default pull-right" %>
          <% end %>
        <% else %>
          <span class="label label-warning"><strong>Sign in to leave a comment</strong></span>
        <% end %>
      </div>
    </div>
  </div>
</div>